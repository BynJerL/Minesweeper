<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minesweeper</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .tile {
            width: 30px;
            height: 30px;
            border: 1px solid black;
            font-weight: 700;
            text-align: center;
        }

        .bomb {
            background-color: red;
        }

        /* Number colors */
        .num1 { color: blue; }
        .num2 { color: green; }
        .num3 { color: red; }
        .num4 { color: navy; }
        .num5 { color: brown; }
        .num6 { color: teal; }
        .num7 { color: black; }
        .num8 { color: gray; }

        .hidden  {
            background-color: lightgray;
            color: transparent;
            cursor: pointer;
            user-select: none;
        }

        .tile:not(.hidden) {
            cursor: default;
        }
    </style>
</head>
<body>
    <div>Total Bombs: <span id="bomb-count"></span></div>
    <table class="tile-area"></table>

    <script>
        const totalRow = 10;
        const totalColumn = 8;
        const tileArea = document.querySelector(".tile-area");
        const totalBomb = 12;

        let isFirstClick = true;

        /** @param {Array} array */
        function shuffle(array){
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[j], array[i]] = [array[i], array[j]];
            }
            return array;
        }

        function generateEmptyBoard() {
            tileArea.innerHTML = "";
            for (let row = 0; row < totalRow; row++) {
                const tileRow = document.createElement("tr");
                for (let col = 0; col < totalColumn; col++) {
                    const tileCol = document.createElement("td");
                    tileCol.className = "tile hidden";
                    tileRow.appendChild(tileCol);
                }
                tileArea.appendChild(tileRow);
            }
        }

        function initializeTileArea (safeIdx) {
            let safeTiles = [];
            const iRow = Math.floor(safeIdx / totalColumn);
            const iCol = safeIdx % totalColumn;

            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    const r = iRow + dr, c = iCol + dc;
                    if (r >= 0 && r < totalRow && c >= 0 && c < totalColumn) {
                        safeTiles.push(r * totalColumn + c);
                    }
                }
            }
            
            let tileNumbers = [];
            for (let num = 0; num < totalRow * totalColumn; num++) tileNumbers.push(num);
            bombTiles = shuffle(tileNumbers.filter(i => !safeTiles.includes(i))).slice(0, totalBomb);

            tileArea.innerHTML = "";
            for (let row = 0; row < totalRow; row++) {
                const tileRow = document.createElement("tr");
                for (let col = 0; col < totalColumn; col++) {
                    const tileCol = document.createElement("td");
                    const tileId = row * totalColumn + col;
                    tileCol.textContent = (bombTiles.includes(tileId))? "ðŸ’£": "";
                    tileCol.className = "tile hidden";
                    tileRow.appendChild(tileCol);
                }
                tileArea.appendChild(tileRow);
            }

            let tileList = document.querySelectorAll(".tile");
            for (let row = 0; row < totalRow; row++) {
                for (let col = 0; col < totalColumn; col++) {
                    const idx = row * totalColumn + col;
                    
                    if (tileList[idx].textContent === "ðŸ’£") {
                        tileList[idx].classList.add("bomb");
                        continue;
                    }

                    const startRow = (row === 0)? 0: row - 1;
                    const startCol = (col === 0)? 0: col - 1;
                    const endRow = (row === totalRow - 1)? totalRow - 1: row + 1;
                    const endCol = (col === totalColumn - 1)? totalColumn - 1: col + 1;

                    let bombNearby = 0;

                    for (let srow = startRow; srow <= endRow; srow++) {
                        for (let scol = startCol; scol <= endCol; scol++) {
                            const sidx = srow * totalColumn + scol;

                            if (tileList[sidx].textContent === "ðŸ’£") {
                                bombNearby++;
                            }
                        }
                    }

                    tileList[idx].textContent = (bombNearby)? bombNearby: "";
                    tileList[idx].classList.add(`num${bombNearby}`);
                }
            }

            tileList.forEach((tile, idx) => {
                tile.addEventListener("click", function(){
                    if (isFirstClick) return;
                    revealTile(idx);
                });
            });
        }

        function revealTile(idx) {
            let tileList = document.querySelectorAll(".tile");
            if (!tileList[idx].classList.contains("hidden")) return;

            tileList[idx].classList.remove("hidden");

            if (tileList[idx].textContent === "") {
                const row = Math.floor(idx / totalColumn);
                const col = idx % totalColumn;

                const startRow = (row === 0)? 0: row - 1;
                const startCol = (col === 0)? 0: col - 1;
                const endRow = (row === totalRow - 1)? totalRow - 1: row + 1;
                const endCol = (col === totalColumn - 1)? totalColumn - 1: col + 1;

                for (let srow = startRow; srow <= endRow; srow++) {
                    for (let scol = startCol; scol <= endCol; scol++) {
                        const sidx = srow * totalColumn + scol;

                        if (tileList[sidx].textContent !== "ðŸ’£") {
                            revealTile(sidx);
                        }
                    }
                }
            }
        }

        generateEmptyBoard();
        document.getElementById("bomb-count").textContent = totalBomb;
        tileArea.addEventListener("click", function handler(e) {
            if (e.target.classList.contains("tile")) {
                const idx = Array.from(tileArea.querySelectorAll(".tile")).indexOf(e.target);
                initializeTileArea(idx);
                isFirstClick = false;
                revealTile(idx);
                tileArea.removeEventListener("click", handler);
            }
        });
    </script>
</body>
</html>